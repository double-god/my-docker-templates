
# 阶段 1: 编译
FROM golang:1.21-alpine AS builder
WORKDIR /app
# 复制 go.mod 和 go.sum
COPY go.* ./
# 下载依赖
RUN go mod download
# 复制所有源代码
COPY . .
# 编译 (CGO_ENABLED=0 是为了静态编译)
RUN CGO_ENABLED=0 GOOS=linux go build -o /app/server .

# 阶段 2: 运行
FROM alpine:latest
WORKDIR /app
# 从编译阶段复制那个二进制文件
COPY --from=builder /app/server /app/server
# (可选) 如果你的 Go 程序需要读 .env 文件或模板，在这里 COPY

# 暴露你 Go 程序监听的端口 (比如 8080)
EXPOSE 8080
# 启动命令
CMD ["/app/server"]